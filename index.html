<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Robacat 3D - Cat Themed Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', cursive, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden;
        }
        
        .container {
            max-width: 1200px;
            width: 100%;
            background: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            margin-top: 20px;
            text-align: center;
        }
        
        h1 {
            font-size: 3em;
            margin-bottom: 20px;
            color: #FFD700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        
        .cat-icon {
            font-size: 4em;
            margin: 20px 0;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        .description {
            font-size: 1.2em;
            margin: 20px 0;
            line-height: 1.6;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .btn {
            background: #FF6B6B;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.2em;
            border-radius: 50px;
            cursor: pointer;
            margin: 15px;
            transition: all 0.3s;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .btn:hover {
            background: #FF5252;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        .features {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
        }
        
        .feature {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            width: 180px;
            transition: transform 0.3s;
        }
        
        .feature:hover {
            transform: scale(1.05);
            background: rgba(255, 255, 255, 0.15);
        }
        
        .feature h3 {
            color: #4ECDC4;
            margin-bottom: 10px;
        }
        
        .footer {
            margin-top: 30px;
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9em;
        }
        
        .form-container {
            display: none;
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .form-group {
            margin: 15px 0;
        }
        
        input {
            width: 80%;
            padding: 12px;
            border-radius: 50px;
            border: none;
            background: rgba(255, 255, 255, 0.9);
            font-size: 1em;
        }
        
        .active {
            display: block;
        }
        
        .game-container {
            display: none;
            position: relative;
            width: 100%;
            height: 600px;
            background: #0a0a2a;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
            border: 3px solid #4ECDC4;
        }
        
        .game-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .game-header {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            background: rgba(0, 0, 0, 0.5);
            border-bottom: 2px solid #4ECDC4;
        }
        
        .player-info {
            display: flex;
            gap: 20px;
        }
        
        .info-box {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: bold;
        }
        
        .game-area {
            flex: 1;
            position: relative;
            overflow: hidden;
        }
        
        .player {
            position: absolute;
            width: 40px;
            height: 40px;
            background: #FF6B6B;
            border-radius: 50%;
            border: 3px solid #FFD700;
            transform: translate(-50%, -50%);
            z-index: 10;
            box-shadow: 0 0 15px rgba(255, 107, 107, 0.7);
        }
        
        .cat {
            position: absolute;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            z-index: 5;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .cat:hover {
            transform: translate(-50%, -50%) scale(1.2);
        }
        
        .base {
            position: absolute;
            width: 100px;
            height: 100px;
            background: #4ECDC4;
            border-radius: 10px;
            border: 3px solid #FFD700;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 20px rgba(78, 205, 196, 0.7);
        }
        
        .instructions {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: left;
        }
        
        .instructions h3 {
            color: #FFD700;
            margin-bottom: 10px;
        }
        
        .instructions ul {
            padding-left: 20px;
        }
        
        .instructions li {
            margin: 8px 0;
        }
        
        .cat-collection {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin: 15px 0;
        }
        
        .cat-type {
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .btn {
                padding: 12px 20px;
                font-size: 1em;
            }
            
            .game-container {
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üêæ Robacat 3D üêæ</h1>
        <div class="cat-icon">üê±</div>
        
        <h2>Cat Themed 3D Game</h2>
        
        <p class="description">
            Control your cat character with WASD keys, move your mouse to look around, 
            and collect cats to earn money! Different cat types give different earnings. 
            Build your base and become the ultimate cat collector!
        </p>
        
        <div class="features">
            <div class="feature">
                <h3>üéÆ 3D Movement</h3>
                <p>WASD controls for movement</p>
            </div>
            <div class="feature">
                <h3>üê± Cat Collection</h3>
                <p>Collect different cat types</p>
            </div>
            <div class="feature">
                <h3>üí∞ Money System</h3>
                <p>Earn $/second from cats</p>
            </div>
        </div>
        
        <button class="btn" onclick="showForm('create')">Create New Game</button>
        <button class="btn" onclick="showForm('join')">Join Existing Game</button>
        
        <div id="createForm" class="form-container">
            <h3>Create New Game</h3>
            <div class="form-group">
                <input type="text" id="createUsername" placeholder="Enter your username" required>
            </div>
            <button class="btn" onclick="createGame()">Create Game</button>
        </div>
        
        <div id="joinForm" class="form-container">
            <h3>Join Existing Game</h3>
            <div class="form-group">
                <input type="text" id="joinUsername" placeholder="Enter your username" required>
            </div>
            <div class="form-group">
                <input type="text" id="gameId" placeholder="Enter Game ID" required>
            </div>
            <button class="btn" onclick="joinGame()">Join Game</button>
        </div>
        
        <div id="gameContainer" class="game-container">
            <div class="game-screen" id="gameScreen">
                <div class="game-header">
                    <div class="player-info">
                        <div class="info-box">Player: <span id="playerName">Loading...</span></div>
                        <div class="info-box">Money: $<span id="playerMoney">0</span></div>
                        <div class="info-box">$/sec: <span id="moneyPerSecond">0</span></div>
                    </div>
                    <div class="info-box">Cats Collected: <span id="catCount">0</span></div>
                </div>
                
                <div class="game-area" id="gameArea">
                    <div class="player" id="player"></div>
                    <div class="base" id="base"></div>
                </div>
                
                <div class="instructions">
                    <h3>How to Play:</h3>
                    <ul>
                        <li>Use <strong>WASD</strong> keys to move your character</li>
                        <li>Move your mouse to look around</li>
                        <li>Click on cats to collect them</li>
                        <li>Each cat type gives different earnings</li>
                        <li>Collect cats to increase your money per second</li>
                    </ul>
                </div>
                
                <div class="cat-collection">
                    <div class="cat-type" style="background: #FFD700;">Tabby ($1/sec)</div>
                    <div class="cat-type" style="background: #FF69B4;">Persian ($2/sec)</div>
                    <div class="cat-type" style="background: #87CEEB;">Siamese ($3/sec)</div>
                    <div class="cat-type" style="background: #9370DB;">Maine Coon ($5/sec)</div>
                    <div class="cat-type" style="background: #FF4500;">Bengal ($7/sec)</div>
                </div>
                
                <button class="btn" onclick="leaveGame()">Leave Game</button>
            </div>
        </div>
    </div>
    
    <div class="footer">
        <p>Robacat 3D - The Ultimate Cat Themed 3D Game</p>
        <p>¬© 2023 Robacat. All rights reserved.</p>
    </div>

    <script>
        let currentGameId = '';
        let currentUsername = '';
        let playerElement = null;
        let gameArea = null;
        let player = null;
        let gameLoopInterval = null;
        let mouseX = 0;
        let mouseY = 0;
        let keys = {};
        let isGameActive = false;
        
        // Initialize game
        function initGame() {
            playerElement = document.getElementById('player');
            gameArea = document.getElementById('gameArea');
            player = {
                x: 400,
                y: 300,
                money: 0,
                moneyPerSecond: 0,
                cats: []
            };
            
            // Set initial player position
            updatePlayerPosition();
            
            // Set up event listeners
            document.addEventListener('keydown', (e) => {
                keys[e.key.toLowerCase()] = true;
            });
            
            document.addEventListener('keyup', (e) => {
                keys[e.key.toLowerCase()] = false;
            });
            
            document.addEventListener('mousemove', (e) => {
                mouseX = e.clientX;
                mouseY = e.clientY;
            });
            
            document.addEventListener('click', (e) => {
                if (isGameActive) {
                    handleCatClick(e);
                }
            });
            
            // Start game loop
            gameLoopInterval = setInterval(updateGame, 100);
        }
        
        function showForm(formType) {
            document.getElementById('createForm').classList.remove('active');
            document.getElementById('joinForm').classList.remove('active');
            
            if (formType === 'create') {
                document.getElementById('createForm').classList.add('active');
            } else {
                document.getElementById('joinForm').classList.add('active');
            }
        }
        
        function createGame() {
            const username = document.getElementById('createUsername').value;
            if (!username) {
                alert('Please enter a username');
                return;
            }
            
            fetch('/create-game', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ username })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(data.error);
                } else {
                    currentUsername = username;
                    currentGameId = data.gameId;
                    document.getElementById('playerName').textContent = username;
                    showGameScreen();
                    initGame();
                    updateGameState();
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Network error');
            });
        }
        
        function joinGame() {
            const username = document.getElementById('joinUsername').value;
            const gameId = document.getElementById('gameId').value;
            
            if (!username || !gameId) {
                alert('Please enter both username and game ID');
                return;
            }
            
            fetch('/join-game', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ username, gameId })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(data.error);
                } else {
                    currentUsername = username;
                    currentGameId = gameId;
                    document.getElementById('playerName').textContent = username;
                    showGameScreen();
                    initGame();
                    updateGameState();
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Network error');
            });
        }
        
        function showGameScreen() {
            document.getElementById('createForm').classList.remove('active');
            document.getElementById('joinForm').classList.remove('active');
            document.getElementById('gameContainer').style.display = 'block';
            isGameActive = true;
        }
        
        function leaveGame() {
            isGameActive = false;
            clearInterval(gameLoopInterval);
            document.getElementById('gameContainer').style.display = 'none';
            showForm('main');
        }
        
        function updateGame() {
            if (!isGameActive) return;
            
            // Move player based on keys
            const speed = 5;
            if (keys['w'] || keys['arrowup']) {
                player.y = Math.max(20, player.y - speed);
            }
            if (keys['s'] || keys['arrowdown']) {
                player.y = Math.min(580, player.y + speed);
            }
            if (keys['a'] || keys['arrowleft']) {
                player.x = Math.max(20, player.x - speed);
            }
            if (keys['d'] || keys['arrowright']) {
                player.x = Math.min(780, player.x + speed);
            }
            
            // Update player position
            updatePlayerPosition();
            
            // Update game state
            updateGameState();
        }
        
        function updatePlayerPosition() {
            playerElement.style.left = player.x + 'px';
            playerElement.style.top = player.y + 'px';
        }
        
        function updateGameState() {
            // Update player info
            document.getElementById('playerMoney').textContent = Math.floor(player.money);
            document.getElementById('moneyPerSecond').textContent = player.moneyPerSecond;
            document.getElementById('catCount').textContent = player.cats.length;
            
            // Update player position on server
            fetch(`/update-position/${currentGameId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ 
                    username: currentUsername,
                    x: player.x,
                    y: player.y
                })
            })
            .catch(error => {
                console.error('Error updating position:', error);
            });
        }
        
        function handleCatClick(event) {
            const rect = gameArea.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            
            // Check if clicked on a cat
            const cats = document.querySelectorAll('.cat');
            cats.forEach(cat => {
                const catRect = cat.getBoundingClientRect();
                const catX = catRect.left - rect.left + 15;
                const catY = catRect.top - rect.top + 15;
                
                const distance = Math.sqrt(Math.pow(x - catX, 2) + Math.pow(y - catY, 2));
                
                if (distance < 20) {
                    // Collect the cat
                    collectCat(cat.dataset.id);
                }
            });
        }
        
        function collectCat(catId) {
            fetch(`/collect-cat/${currentGameId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ 
                    username: currentUsername,
                    catId: catId
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    player.money = data.money;
                    player.moneyPerSecond = data.moneyPerSecond;
                    
                    // Remove cat from UI
                    const catElement = document.querySelector(`.cat[data-id="${catId}"]`);
                    if (catElement) {
                        catElement.remove();
                    }
                    
                    // Update player info
                    updateGameState();
                } else {
                    console.error('Failed to collect cat:', data.error);
                }
            })
            .catch(error => {
                console.error('Error collecting cat:', error);
            });
        }
        
        // Initialize when page loads
        window.addEventListener('load', () => {
            // Create some sample cats for demo
            const base = document.getElementById('base');
            base.style.left = '50px';
            base.style.top = '50px';
            
            // Add some sample cats
            for (let i = 0; i < 10; i++) {
                const cat = document.createElement('div');
                cat.className = 'cat';
                cat.dataset.id = 'cat-' + i;
                cat.style.left = (100 + Math.random() * 600) + 'px';
                cat.style.top = (100 + Math.random() * 400) + 'px';
                cat.style.background = catTypes[Math.floor(Math.random() * catTypes.length)].color;
                gameArea.appendChild(cat);
            }
        });
    </script>
</body>
</html>

